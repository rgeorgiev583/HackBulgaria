package com.hackbulgaria.corejava;

import java.awt.Color;
import java.awt.image.BufferedImage;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;

import javax.imageio.ImageIO;

public class ASCIIArtViewer {
	public static final String newline = System.getProperty("line.separator");
	BufferedImage image;
	
	public ASCIIArtViewer(String path) {
		File file = new File(path);
		
		try {
			image = ImageIO.read(file);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	public char getASCIIPixel(int x, int y, int blockWidth, int blockHeight) {
		int intensity = 0;
		
		for (int i = 0; i < blockHeight; i++) {
			for (int j = 0; j < blockWidth; j++) {
				Color color = new Color(image.getRGB(x + j, y + i));
				intensity += (color.getRed() + color.getGreen() + color.getBlue()) / 3;
			}
		}

		intensity /= blockWidth * blockHeight;
		
		if (intensity > 240) {
			return ' ';
		}
		else if (intensity > 200 && intensity <= 240) {
			return '.';
		}
		else if (intensity > 160 && intensity <= 200) {
			return '*';
		}
		else if (intensity > 120 && intensity <= 160) {
			return 'x';
		}
		else if (intensity > 80 && intensity <= 120) {
			return '$';
		}
		else if (intensity > 40 && intensity <= 80) {
			return '#';
		}
		else {
			return '@';
		}
	}

	public char getASCIIPixel(int x, int y) {
		Color color = new Color(image.getRGB(x, y));
		int intensity = (color.getRed() + color.getGreen() + color.getBlue()) / 3;
		
		if (intensity > 240) {
			return ' ';
		}
		else if (intensity > 200 && intensity <= 240) {
			return '.';
		}
		else if (intensity > 160 && intensity <= 200) {
			return '*';
		}
		else if (intensity > 120 && intensity <= 160) {
			return '+';
		}
		else if (intensity > 80 && intensity <= 120) {
			return 'x';
		}
		else if (intensity > 40 && intensity <= 80) {
			return '#';
		}
		else {
			return '@';
		}
	}
	
	public String getASCIIArt() {
		int width = image.getWidth(), height = image.getHeight();
		String art = "";
		
		for (int i = 0; i < height; i++) {
			for (int j = 0; j < width; j++) {
				art += getASCIIPixel(j, i);
			}
			
			art += newline;
		}
		
		return art;
	}
		
	public String getASCIIArt(int maxCols) {
		int width = image.getWidth(), height = image.getHeight();
		int blockWidth = width / maxCols, blockHeight = height / maxCols;
		String art = "";
		
		for (int i = 0; i < height; i += blockHeight) {
			for (int j = 0; j < width; j += blockWidth) {
				art += getASCIIPixel(j, i, j + blockWidth < width ? blockWidth : width - j, i + blockHeight < height ? blockHeight : height - i);
			}
			
			art += newline;
		}
		
		return art;
	}
	
	public void writeASCIIArtToFile(File file)
	{
		try {
			BufferedWriter writer = new BufferedWriter(new FileWriter(new File(args[1])));
			writer.write(str);
		} catch()
	
	public static void main(String[] args)

		System.out.println(new ASCIIArtViewer(args[0]).getASCIIArt());
	}
}
